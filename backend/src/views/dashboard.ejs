<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= title %></title>
    <style>
      :root {
        --primary-color: #3498db;
        --secondary-color: #2c3e50;
        --success-color: #2ecc71;
        --warning-color: #f39c12;
        --danger-color: #e74c3c;
        --light-color: #ecf0f1;
        --dark-color: #34495e;
        --gray-color: #95a5a6;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background-color: #f5f5f5;
        color: #333;
        line-height: 1.6;
      }

      .container {
        display: flex;
        min-height: 100vh;
      }

      /* Sidebar */
      .sidebar {
        width: 250px;
        background-color: var(--secondary-color);
        color: white;
        padding: 20px 0;
        position: fixed;
        height: 100vh;
        overflow-y: auto;
      }

      .sidebar-header {
        padding: 0 20px 20px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        text-align: center;
      }

      .sidebar-header h1 {
        font-size: 1.5rem;
        margin-bottom: 5px;
      }

      .sidebar-header p {
        font-size: 0.8rem;
        opacity: 0.7;
      }

      .sidebar-menu {
        padding: 20px 0;
      }

      .menu-item {
        padding: 10px 20px;
        display: block;
        color: white;
        text-decoration: none;
        transition: background-color 0.2s;
      }

      .menu-item:hover {
        background-color: rgba(255, 255, 255, 0.1);
      }

      .menu-item.active {
        background-color: var(--primary-color);
        border-left: 4px solid white;
      }

      .sidebar-footer {
        padding: 20px;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        font-size: 0.8rem;
        text-align: center;
        position: absolute;
        bottom: 0;
        width: 100%;
      }

      /* Main Content */
      .main-content {
        flex: 1;
        margin-left: 250px;
        padding: 20px;
      }

      .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 1px solid #ddd;
      }

      .page-title {
        font-size: 1.8rem;
        color: var(--secondary-color);
      }

      .user-info {
        display: flex;
        align-items: center;
      }

      .user-name {
        margin-right: 10px;
      }

      .logout-btn {
        background-color: transparent;
        border: none;
        color: var(--primary-color);
        cursor: pointer;
        text-decoration: underline;
      }

      /* Dashboard Cards */
      .dashboard-cards {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .card {
        background-color: white;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        padding: 20px;
      }

      .card-header {
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 1px solid #eee;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .card-title {
        font-size: 1.2rem;
        color: var(--secondary-color);
      }

      .card-body {
        margin-bottom: 15px;
      }

      .stat {
        font-size: 2rem;
        font-weight: bold;
        margin-bottom: 5px;
      }

      .stat-label {
        font-size: 0.9rem;
        color: var(--gray-color);
      }

      .risk-stats {
        display: flex;
        justify-content: space-between;
      }

      .risk-stat {
        text-align: center;
        padding: 10px;
        border-radius: 4px;
        flex: 1;
        margin: 0 5px;
      }

      .risk-high {
        background-color: rgba(231, 76, 60, 0.1);
        color: var(--danger-color);
      }

      .risk-medium {
        background-color: rgba(243, 156, 18, 0.1);
        color: var(--warning-color);
      }

      .risk-low {
        background-color: rgba(46, 204, 113, 0.1);
        color: var(--success-color);
      }

      .risk-unknown {
        background-color: rgba(149, 165, 166, 0.1);
        color: var(--gray-color);
      }

      /* Tables */
      .table-container {
        background-color: white;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        padding: 20px;
        margin-bottom: 30px;
        overflow-x: auto;
      }

      .table-header {
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 1px solid #eee;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .table-title {
        font-size: 1.2rem;
        color: var(--secondary-color);
      }

      .table {
        width: 100%;
        border-collapse: collapse;
      }

      .table th,
      .table td {
        padding: 12px 15px;
        text-align: left;
        border-bottom: 1px solid #eee;
      }

      .table th {
        background-color: #f8f9fa;
        font-weight: 600;
        color: var(--secondary-color);
      }

      .table tbody tr:hover {
        background-color: #f8f9fa;
      }

      .badge {
        display: inline-block;
        padding: 3px 8px;
        border-radius: 4px;
        font-size: 0.8rem;
        font-weight: 500;
      }

      .badge-high {
        background-color: var(--danger-color);
        color: white;
      }

      .badge-medium {
        background-color: var(--warning-color);
        color: white;
      }

      .badge-low {
        background-color: var(--success-color);
        color: white;
      }

      .badge-unknown {
        background-color: var(--gray-color);
        color: white;
      }

      .badge-pending {
        background-color: var(--gray-color);
        color: white;
      }

      .badge-processing {
        background-color: var(--primary-color);
        color: white;
      }

      .badge-completed {
        background-color: var(--success-color);
        color: white;
      }

      .badge-failed {
        background-color: var(--danger-color);
        color: white;
      }

      /* Buttons */
      .btn {
        display: inline-block;
        padding: 8px 16px;
        border-radius: 4px;
        font-size: 0.9rem;
        font-weight: 500;
        cursor: pointer;
        text-decoration: none;
        transition: background-color 0.2s;
        border: none;
      }

      .btn-primary {
        background-color: var(--primary-color);
        color: white;
      }

      .btn-primary:hover {
        background-color: #2980b9;
      }

      .btn-secondary {
        background-color: var(--light-color);
        color: var(--dark-color);
      }

      .btn-secondary:hover {
        background-color: #bdc3c7;
      }

      .btn-success {
        background-color: var(--success-color);
        color: white;
      }

      .btn-success:hover {
        background-color: #27ae60;
      }

      .btn-danger {
        background-color: var(--danger-color);
        color: white;
      }

      .btn-danger:hover {
        background-color: #c0392b;
      }

      .btn-sm {
        padding: 4px 8px;
        font-size: 0.8rem;
      }

      /* Responsive */
      @media (max-width: 768px) {
        .container {
          flex-direction: column;
        }

        .sidebar {
          width: 100%;
          height: auto;
          position: relative;
        }

        .sidebar-footer {
          position: relative;
        }

        .main-content {
          margin-left: 0;
        }

        .dashboard-cards {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Sidebar -->
      <div class="sidebar">
        <div class="sidebar-header">
          <h1>PrivacyGuard</h1>
          <p>Admin Dashboard</p>
        </div>

        <div class="sidebar-menu">
          <a href="/admin" class="menu-item active">Dashboard</a>
          <a href="/admin/assessments" class="menu-item">Assessments</a>
          <a href="/admin/unassessed" class="menu-item">Unassessed URLs</a>
          <a href="/admin/analytics" class="menu-item">Analytics</a>
          <a href="/admin/users" class="menu-item">Users</a>
          <a href="/admin/audit-logs" class="menu-item">Audit Logs</a>
        </div>

        <div class="sidebar-footer">
          &copy; <%= new Date().getFullYear() %> PrivacyGuard
        </div>
      </div>

      <!-- Main Content -->
      <div class="main-content">
        <div class="page-header">
          <h1 class="page-title">Dashboard</h1>

          <div class="user-info">
            <span class="user-name">Welcome, <%= user.name %></span>
            <a href="/admin/logout" class="logout-btn">Logout</a>
          </div>
        </div>

        <!-- Dashboard Cards -->
        <div class="dashboard-cards">
          <div class="card">
            <div class="card-header">
              <h2 class="card-title">Assessment Stats</h2>
            </div>
            <div class="card-body">
              <div class="stat"><%= stats.total %></div>
              <div class="stat-label">Total Assessments</div>

              <div class="risk-stats">
                <div class="risk-stat risk-high">
                  <div class="stat"><%= stats.riskCounts.high %></div>
                  <div class="stat-label">High Risk</div>
                </div>
                <div class="risk-stat risk-medium">
                  <div class="stat"><%= stats.riskCounts.medium %></div>
                  <div class="stat-label">Medium Risk</div>
                </div>
                <div class="risk-stat risk-low">
                  <div class="stat"><%= stats.riskCounts.low %></div>
                  <div class="stat-label">Low Risk</div>
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h2 class="card-title">Unassessed URLs</h2>
              <a href="/admin/unassessed" class="btn btn-primary btn-sm"
                >View All</a
              >
            </div>
            <div class="card-body">
              <div class="stat"><%= stats.unassessedCount %></div>
              <div class="stat-label">URLs Pending Assessment</div>
            </div>
          </div>
        </div>

        <!-- Recent Assessments Table -->
        <div class="table-container">
          <div class="table-header">
            <h2 class="table-title">Recent Assessments</h2>
            <a href="/admin/assessments" class="btn btn-primary btn-sm"
              >View All</a
            >
          </div>

          <table class="table">
            <thead>
              <tr>
                <th>URL</th>
                <th>Risk Level</th>
                <th>Last Updated</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <% if (recentAssessments && recentAssessments.length > 0) { %> <%
              recentAssessments.forEach(assessment => { %>
              <tr>
                <td><%= assessment.url %></td>
                <td>
                  <span
                    class="badge badge-<%= assessment.riskLevel.toLowerCase() %>"
                  >
                    <%= assessment.riskLevel %>
                  </span>
                </td>
                <td>
                  <%= new Date(assessment.last_updated).toLocaleString() %>
                </td>
                <td>
                  <a
                    href="/admin/assessments/<%= encodeURIComponent(assessment.url) %>"
                    class="btn btn-secondary btn-sm"
                    >View</a
                  >
                </td>
              </tr>
              <% }); %> <% } else { %>
              <tr>
                <td colspan="4" style="text-align: center">
                  No assessments found
                </td>
              </tr>
              <% } %>
            </tbody>
          </table>
        </div>

        <!-- Recent Activity Table -->
        <div class="table-container">
          <div class="table-header">
            <h2 class="table-title">Recent Activity</h2>
            <a href="/admin/audit-logs" class="btn btn-primary btn-sm"
              >View All</a
            >
          </div>

          <table class="table">
            <thead>
              <tr>
                <th>Action</th>
                <th>User</th>
                <th>Timestamp</th>
                <th>Details</th>
              </tr>
            </thead>
            <tbody>
              <% if (recentLogs && recentLogs.length > 0) { %> <%
              recentLogs.forEach(log => { %>
              <tr>
                <td><%= log.action.replace(/_/g, ' ') %></td>
                <td><%= log.user_id || 'System' %></td>
                <td><%= new Date(log.timestamp).toLocaleString() %></td>
                <td>
                  <%= JSON.stringify(log.details).substring(0, 50) %><%=
                  JSON.stringify(log.details).length > 50 ? '...' : '' %>
                </td>
              </tr>
              <% }); %> <% } else { %>
              <tr>
                <td colspan="4" style="text-align: center">
                  No activity logs found
                </td>
              </tr>
              <% } %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </body>
</html>
